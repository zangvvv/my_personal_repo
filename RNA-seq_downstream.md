# <font face="仿宋" color=orange>转录组下游分析</font>
# <center><font face="楷体" size=5>by 藏之地</font></center>
老师给的是tpm的表达矩阵（目前TPM才是基因定量单位的主流），关于TPM的定义暂时就先不管，直接往后走；
## 一、进行正式的差异分析前的准备知识（还是得简单了解一下TPM）
- [生信技能树-day19 转录组下游分析-标准化、聚类、差异分析](https://mp.weixin.qq.com/s/ghy2ecWGwL2Yc5-XDohulg)
### 1.1 数据标准化
1. 标准化前的数据预处理
    - 作用：过滤低表达的基因，并检查是否有异常样本;
    - 以下是常见的几种过滤方式（过滤的标准都可以自己调整）
        - 在至少在75%的样本中都表达的基因（表达是指在某个样本中count值＞0）；
        - 过滤平均值count<10的基因；
        - 过滤平均cpm<10的基因；
2. 标准化
    - 为什么要进行标准化？（疑惑：同一批次的样品，测序深度是一样的吗，或者说大概率是一样的吧？）
        - [我要自学生信之生信基础-转录组：分析流程大全解，看这一篇就够了](https://zhuanlan.zhihu.com/p/268518822)
        - 基因长度的影响：测序时，打断成的reads长度一般都是固定的（比如150bp）。如果基因A很长，基因B很短，那么基因A就可以打断成更多的片段，假如原本两基因表达量是一样的，但是由于基因A被打断成更多的片段，也就更容易比对到这个基因上；视基因类型而定，比如microRNA稳定在20+长度，则不用针对长度进行标准化。
        - 测序深度（sequencing depth）的影响（测序深度就是总数据量比上该物种基因组大小）：每个样本的测序深度（产生的数据量）不完全一样，同一条件下，测序深度越深，基因表达的read读数越多。
        - 所以标准化的主要目的就是去除这两个因素的影响。
    - 标准化的表达值与raw counts的使用场景：
        - 如果是差异表达分析，一般用的原始count值，比如limma、edgeR和DESeq2（暂时只用过DESeq2）（二代测序差异分析算法内部一般有自己的标化方法。）
        - 标准化后的值：基因表达值在样本与样本之间具有可比性。比如PCA分析，样本表达总体分布，生存分析，热图绘制，相关性分析等
3. [FPKM,TPM, Counts: 谁更适合做差异分析？](https://mp.weixin.qq.com/s/2nGsywVxvUg5X08-ZDQThQ)
    - 首先，gene counts不能与基因的表达量划等号很好理解，而TPM相比于FPKM考虑到了个样本文库大小之间的差异，更加准确；
    - "TPM, FPKM, or Normalized Counts?..."一文指出：TPM和FPKM仅适合用于样本内不同基因表达量的高低比较，而不能用于同一基因在不同样本、不同分组间的比较。具体成分上面这篇教程有讲到，总之就是建议使用基于counts的差异分析（即DESeq2或edgeR），而不要用TPM与FPKM这类经"normalization"后的值。
4. [数据是TPM，想做差异只能转换？](https://mp.weixin.qq.com/s/Z68LhqHlcBNrK6QhiXFy9A)
### 1.2 异常样本与重复性检测
1. [转录组专题|关于样本重复性问题](https://zhuanlan.zhihu.com/p/444061613)
    - [如何区分生物学重复和技术性重复？](https://zhuanlan.zhihu.com/p/276402875)
        - 技术性重复：对**单个个体**的相同的实验，比如对一个人进行三次采血或者对一个人的采血样品进行三次测量都属于技术性重复；因为只测量单个个体，所以只能拿到该个体样本的精确测量结果，但是不能把结果类推到群体中。
        - 生物学重复：使用不同个体进行测量数据，可以使结论具有普适性。
        - 对一般实验来说，增加生物学重复，减少技术重复会更划算。比如，做转录组测序时，最好做生物学重复，而不是技术重复。
    - 每个处理多少个生物学重复？
        - ① 对于动植物样品，建议3~5个生物学重复，对生物学样品之间做相关性检验，提高实验结果的可信度；
        - ② 对于细胞样品，生物学重复之间的差异性相对较小，建议3个以上生物学重复；
        - ③ 对于临床样品，由于供试者的基因型、生活方式、生活环境、年龄、性别可能存在较大差异，可能需要更多的生物学重复，一般10个生物学重复以上。
        - 在转录组测序时，一般不建议设置两个重复。因为如果两个重复样品结果不一致，无法确定以哪个数据为参考。
    - 判断组内重复性好坏的方法：
        - 在实际分析中，通常结合PCA和相关性系数综合判断样本是否离群。
            - <img src="https://zangvvv-img.oss-cn-nanjing.aliyuncs.com/figure_bed/20250317210956.png"/> 
        1. PCA：
            - 原理：用方差（Variance）来衡量数据的差异性，将高维数据用某几个综合指标来表示。将原本鉴定到的所有基因的表达量重新线性组合，形成一组新的综合变量，同时根据所分析的问题从中选取2-3个综合变量，使它们尽可能多地反映原有变量的信息，从而达到降维的目的。
            - 关于转录组测序，我们可能获得上万个基因的表达信息，那么利用PCA可将样本所包含的上万个维度的信息（上万个基因的表达量），降维至某些维度的综合指标（主成分）表示。一般选取PC1和PC2，来解释样本间的重复性好坏与组间样本的差异度。如下图PCA散点图，组内样本呈现相互聚集，说明组内的重复性比较好。
            - <img src="https://zangvvv-img.oss-cn-nanjing.aliyuncs.com/figure_bed/20250317211251.png"/>
            - 在文章中，也会看到三维的PCA图。这时选取了PC1，PC2，PC3去解释样本间的距离。PC1+PC2（+PC3）越大，对方差解释度越大，越具有说服力。
        2. 相关系数：
            - 通常计算两个样品之间的Pearson或Spearman相关系数判断组内重复性情况。相关系数越接近1，样品间相似度越高。一般情况下，组内生物学样本相关系数大于组间样本，则表明组内重复性较好；
            - 一般情况下，计算相关性系数时，对于生物学重复（如采样时个体差异）之间的相关系数依据经验建议在0.7以上较好；对于技术重复（实验操作、实验仪器等）之间的相关系数依据项目经验来说在0.85以上比较合理。
            - 对于转录组数据，可以利用样本的表达谱来计算样本间的相关性，通过计算相关系数r来评估每组样本的生物重复性。最常用的度量是Pearson和Spearman相关系数。对于Pearson相关系数很简单，主要用来衡量两个数据集的线性相关程度。
            - 置于如何选择：看下面例子：比如，某个实验做了3次生物学重复，那有理由假设这3次重复线性相关。而如果是一个基因和另一个受到调控的基因的表达水平，或者某个基因顺式作用元件的染色质开放程度，和这个基因表达水平之间的关系就可能需要假设单调相关。
            - 与PCA的比较：更能判断样本的重复性，因为PCA为把对样品贡献大的信息保留，所描述的是整体所有组的特征；而相关系数直接呈现的是两组样品之间的相关程度。若相关系数越高，表明两组样品之间的相关程度越高，即重复性越好。
        3. 样本聚类：可用于判断在不同实验条件下的表达模式。依据样品的表达谱进行聚类，样品之间重复性较好时通常会聚在同一分支下。如果组内样本重复性较差可能会呈现无规则的聚类形式；
        4. 重复性散点图：展示组内样本的重复性情况。图中偏离对角线的点越少，样品间的相关性越高，重复性越好。
    - 样本离群了还能用于分析吗？
        - 首先判断离群程度，若离群程度较小，则可以尝试设置阈值，缩小基因范围，再次重新进行相关性分析判断样本是否离群。若离群程度很大，对后续差异分析的结果造成了很大的影响，那么可以考虑将该样本剔除，再进行后续差异分析等等。转录组测序通常要求设置3个生物学重复样本，如果样本足够多，建议比预期实验设计多送1~2个样本测序，以便后续某个样品与组内其它样本出现离群情况，直接剔除离群样本，省时省力。若测序样本较少，无法剔除样本，也可以考虑对同一批次的备份样本再次测序，后续再重新分析。
2. 进行异常样本与重复性检测的目的
    - 检查组内样本的重复性是否好;
    - 检查组间样本是否可以较好的分开;
    - 是否有离群样本;
3.  
## 二、进行 

